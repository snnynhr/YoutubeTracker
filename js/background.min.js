var g=JSON.parse(localStorage.getItem("bst")),k=localStorage.getItem("num"),l=localStorage.getItem("dss"),n=localStorage.getItem("min"),p=localStorage.getItem("queue");function q(){null===g&&r();null===k&&localStorage.setItem("num",0);null===p&&s();null!==l?l=parseInt(l):localStorage.setItem("dss",101);null!==n?n=parseInt(n):localStorage.setItem("min",20);s();window.webkitRequestFileSystem(window.TEMPORARY,1048576,u,v)}
function v(b){msg="";switch(b.code){case FileError.QUOTA_EXCEEDED_ERR:msg="QUOTA_EXCEEDED_ERR";break;case FileError.NOT_FOUND_ERR:window.webkitRequestFileSystem(window.TEMPORARY,1048576,w,A);break;case FileError.SECURITY_ERR:msg="SECURITY_ERR";break;case FileError.INVALID_MODIFICATION_ERR:msg="INVALID_MODIFICATION_ERR";break;case FileError.INVALID_STATE_ERR:msg="INVALID_STATE_ERR";break;default:msg="Unknown Error"}""!==msg&&console.log("Error: "+msg)}q();
function r(){for(var b=parseInt(localStorage.getItem("dss")),a=[],c=0,c=0;c<b;c++)a[c]=[];localStorage.setItem("bst",JSON.stringify(a))}function s(){localStorage.setItem("queue",JSON.stringify([void 0,void 0,void 0,void 0,void 0]))}
function A(b){var a="";switch(b.code){case FileError.QUOTA_EXCEEDED_ERR:a="QUOTA_EXCEEDED_ERR";break;case FileError.NOT_FOUND_ERR:a="NOT_FOUND_ERR";break;case FileError.SECURITY_ERR:a="SECURITY_ERR";break;case FileError.INVALID_MODIFICATION_ERR:a="INVALID_MODIFICATION_ERR";break;case FileError.INVALID_STATE_ERR:a="INVALID_STATE_ERR";break;default:a="Unknown Error"}console.log("Error: "+a)}
function w(b){b.root.getFile("yttrack.txt",{create:!0},function(a){a.createWriter(function(a){a.onwriteend=function(){console.log("Write completed.")};a.onerror=function(a){console.log("Write failed: "+a.toString())};a.write(new Blob([""],{type:"text/plain"}))},A)},A)}
function u(b){b.root.getFile("yttrack.txt",{create:!1},function(a){a.createWriter(function(a){a.seek(a.length);var b=JSON.parse(localStorage.getItem("bst")),d="";for(i=0;i<b.length;i++)for(j=0;j<b[i].length;j++)d+=b[i][j][0]+": "+b[i][j][1]+"\n";r();localStorage.setItem("num",0);a.write(new Blob([d],{type:"text/plain"}))},A)},v)}
function B(b,a){var c=JSON.parse(localStorage.getItem("bst")),h=parseInt(localStorage.getItem("num")),d=b.search("www.youtube.com/watch");if(0<=d){var d=b.substring(d+21),t=!1,f=parseInt(localStorage.getItem("dss")),e=parseInt(localStorage.getItem("dss"));x=new BigInteger(SHA1(d),16);y=new BigInteger(e.toString(16),16);z=x.i(y);for(var f=(parseInt(z.toString(16),16)%f+f)%f,e=c[f],m=1;m<e.length;m++)if(0===d.localeCompare(e[m][0])){t=!0;break}t||(0<=a.substring(a.length-10).search("YouTube")&&(a=a.substring(0,
a.length-10)),e[e.length]=[d,a],c[f]=e,localStorage.setItem("bst",JSON.stringify(c)),c=JSON.parse(localStorage.getItem("queue")),c.shift(),c.push(f+" "+e.length),localStorage.setItem("queue",JSON.stringify(c)),localStorage.setItem("num",h+1),c=localStorage.getItem("min"),h>c&&window.webkitRequestFileSystem(window.TEMPORARY,1048576,u,A))}}
chrome.f.j.addListener(function(b,a){if("updated"==b.a)q();else if("track"==b.a)B(a.b.url,a.b.title);else if("generate"==b.a)console.log("Generate called at "+b.url),chrome.c.create({d:!1,e:!0,url:"http://www.flv2mp3.com/"},function(a){setTimeout(function(){C(a.id,b.url)},3E3)});else if("getUrl"==b.a){var c=a.b.url,h=c.search("download/");url_n=c.substring(0,h+9)+"direct/"+c.substring(h+9);console.log("Creating "+url_n);chrome.c.create({d:!1,e:!0,url:url_n},function(){chrome.c.remove(a.b.id)})}else console.log(b.a)});
function C(b,a){chrome.c.k(b,{url:a},function(a){console.log(chrome.f.h);console.log(a.g)})};
